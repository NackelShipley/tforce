<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dock Barcode Tool</title>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  background: #f4f6f8;
  color: #111;
}

header {
  background: white;
  padding: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
}

h1 { margin: 0; font-size: 18px; }

.menu-btn {
  font-size: 22px;
  background: none;
  border: none;
  cursor: pointer;
}

.action-menu {
  position: absolute;
  right: 16px;
  top: 60px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  display: none;
  flex-direction: column;
  min-width: 180px;
  overflow: hidden;
}

.action-menu button {
  padding: 12px;
  border: none;
  background: white;
  text-align: left;
  cursor: pointer;
}

.action-menu button:hover {
  background: #f0f0f0;
}

.action-menu .danger {
  color: #b00020;
}

.container {
  padding: 16px;
}

input, select, button {
  padding: 10px;
  margin: 6px 0;
  width: 100%;
  box-sizing: border-box;
}

#barcodeViewer {
  display: grid;
  gap: 16px;
  margin-top: 16px;
}

.barcode-item {
  background: white;
  padding: 12px;
  border-radius: 12px;
  position: relative;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.barcode-item svg {
  width: 100%;
}

.tracking-label {
  font-weight: 600;
  margin-top: 6px;
}

.door-select {
  margin-top: 6px;
}

.delete-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  border: none;
  background: none;
  cursor: pointer;
}

.delete-btn svg {
  width: 18px;
  height: 18px;
  fill: #888;
}

.delete-btn:hover svg {
  fill: #b00020;
}

/* Camera modal */
#scannerModal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  display: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

#scanner {
  width: 320px;
}

.scan-frame {
  width: 280px;
  height: 140px;
  border: 3px solid white;
  border-radius: 12px;
  margin-bottom: 10px;
}

footer {
  text-align: center;
  padding: 12px;
  font-size: 12px;
  color: #666;
}

/* PRINT STYLES */
#printContainer { display: none; }

.print-page {
  width: 8.5in;
  height: 11in;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(4, 1fr);
  gap: 0.6in;
  padding: 0.6in;
  box-sizing: border-box;
  background: white;
}

.print-barcode {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border: 1px solid #ccc;
  border-radius: 12px;
  padding: 14px;
}

.print-barcode svg { width: 100%; }

.print-tracking { margin-top: 6px; font-weight: 600; }

.print-door { margin-top: 4px; font-size: 13px; }

@media print {
  body > *:not(#printContainer) { display: none !important; }
  #printContainer { display: block; }
  .print-page { page-break-after: always; }
}
</style>
</head>
<body>

<header>
  <h1>Dock Barcode Tool</h1>
  <button class="menu-btn" id="menuBtn">â˜°</button>

  <div class="action-menu" id="actionMenu">
    <button onclick="printBarcodes()">Print</button>
    <button onclick="shareBarcodes()">Share</button>
    <button onclick="toggleView()">Change View</button>
    <button class="danger" onclick="clearAll()">Clear All</button>
  </div>
</header>

<div class="container">
  <input id="trackingInput" placeholder="Enter tracking numbers (, or ; separated)" />
  <select id="doorSelect">
  </select>
  <button onclick="addBarcodes()">Add</button>
  <button onclick="openScanner()">Scan Barcode</button>

  <div id="barcodeViewer"></div>
</div>

<div id="scannerModal">
  <div class="scan-frame"></div>
  <div id="scanner"></div>
  <button onclick="closeScanner()">Close</button>
</div>

<div id="printContainer"></div>

<footer>
  Built by Nackel Shipley
</footer>

<script>
const viewer = document.getElementById("barcodeViewer");
const menuBtn = document.getElementById("menuBtn");
const actionMenu = document.getElementById("actionMenu");

menuBtn.onclick = e => {
  e.stopPropagation();
  actionMenu.style.display = actionMenu.style.display === "flex" ? "none" : "flex";
};

document.onclick = () => actionMenu.style.display = "none";

function addBarcodes(value=null) {
  const input = value || document.getElementById("trackingInput").value;
  const door = document.getElementById("doorSelect").value;
  if (!input) return;

  input.split(/[,;]+/).forEach(code => {
    code = code.trim();
    if (!code) return;

    const item = document.createElement("div");
    item.className = "barcode-item";

    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    JsBarcode(svg, code, { format: "CODE128" });

    const label = document.createElement("div");
    label.className = "tracking-label";
    label.textContent = code;

    const select = document.createElement("select");
    select.className = "door-select";
    ["Door 1","Door 2","Door 3"].forEach(d=>{
      const opt=document.createElement("option");
      opt.value=d; opt.textContent=d;
      if(d===door) opt.selected=true;
      select.appendChild(opt);
    });

    const del = document.createElement("button");
    del.className="delete-btn";
    del.innerHTML=`<svg viewBox="0 0 24 24"><path d="M3 6h18M8 6V4h8v2m-1 0v14H9V6h6z"/></svg>`;
    del.onclick=()=>{
      if(confirm("Delete this barcode?")) item.remove();
    };

    item.appendChild(del);
    item.appendChild(svg);
    item.appendChild(label);
    item.appendChild(select);

    viewer.prepend(item);
  });

  document.getElementById("trackingInput").value="";
}

function clearAll(){
  if(confirm("Clear all barcodes?")) viewer.innerHTML="";
}

function toggleView(){
  viewer.style.gridTemplateColumns =
    viewer.style.gridTemplateColumns === "1fr" ? "repeat(auto-fit,minmax(250px,1fr))" : "1fr";
}

/* CAMERA */
let scanner;
function openScanner(){
  document.getElementById("scannerModal").style.display="flex";
  scanner=new Html5Qrcode("scanner");
  scanner.start({facingMode:"environment"}, {fps:10, qrbox:{width:280,height:140}},
    decoded=>{
      navigator.vibrate?.(50);
      addBarcodes(decoded);
      closeScanner();
    });
}
function closeScanner(){
  document.getElementById("scannerModal").style.display="none";
  scanner?.stop();
}

/* PRINT + SHARE */
function buildPrintPages(){
  const items=document.querySelectorAll(".barcode-item");
  if(!items.length){alert("No barcodes.");return null;}
  const container=document.getElementById("printContainer");
  container.innerHTML="";
  for(let i=0;i<items.length;i+=8){
    const page=document.createElement("div");
    page.className="print-page";
    [...items].slice(i,i+8).forEach(item=>{
      const card=document.createElement("div");
      card.className="print-barcode";
      card.appendChild(item.querySelector("svg").cloneNode(true));
      const t=document.createElement("div");
      t.className="print-tracking";
      t.textContent=item.querySelector(".tracking-label").textContent;
      const d=document.createElement("div");
      d.className="print-door";
      d.textContent=item.querySelector(".door-select").value;
      card.appendChild(t);
      card.appendChild(d);
      page.appendChild(card);
    });
    container.appendChild(page);
  }
  return container;
}

function printBarcodes(){
  const c=buildPrintPages();
  if(!c) return;
  window.print();
}

async function shareBarcodes(){
  const c=buildPrintPages();
  if(!c) return;
  c.style.display="block";
  await new Promise(r=>requestAnimationFrame(r));
  const canvas=await html2canvas(c,{scale:3,backgroundColor:"#fff"});
  c.style.display="none";
  const blob=await new Promise(r=>canvas.toBlob(r,"image/png"));
  const file=new File([blob],"DockBarcodes.png",{type:"image/png"});
  if(navigator.canShare&&navigator.canShare({files:[file]})){
    navigator.share({files:[file],title:"Dock Barcodes"});
  } else {
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;a.download="DockBarcodes.png";a.click();
  }
}

const doorSelect=document.getElementById("doorSelect");
for(let i=1;i<=25;i++){
let opt=document.createElement("option");
opt.value="Door "+i; opt.textContent="Door "+i; doorSelect.appendChild(opt);
}
</script>

</body>
</html>
